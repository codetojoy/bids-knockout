<!--
  Copyright 2026 Michael Easter / @codetojoy

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bids</title>
    <link rel="stylesheet" href="css/app.css">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>
<body>
    <nav aria-label="Game controls">
        <h2>Bids</h2>
        <button aria-label="Start a new game" data-bind="click: newGame">New Game</button>
        <button data-bind="click: reveal, text: revealButtonText, attr: { 'aria-label': revealed() ? 'Hide all hands' : 'Reveal all hands' }"></button>
        <button aria-label="Open game configuration" data-bind="click: config">Config</button>
    </nav>
    <main>
        <!-- ko if: currentView() === "main" -->
        <div>
            <h1>Welcome to Bids</h1>
            <p>Click "New Game" to start a game.</p>
        </div>
        <!-- /ko -->

        <!-- ko if: currentView() === "game" -->
        <div class="game-board" role="region" aria-label="Game board">
            <div class="game-section">
                <h2>Kitty</h2>
                <div class="card-row">
                    <!-- ko foreach: kitty -->
                    <button class="card-btn" data-bind="text: $root.revealed() ? $data : '', css: { 'hidden-card': !$root.revealed() }"></button>
                    <!-- /ko -->
                </div>
            </div>
            <div class="game-section prize-area" aria-live="polite" aria-label="Prize card area">
                <h2>Prize</h2>
                <!-- ko if: prizeCard() !== null -->
                <button class="card-btn prize-card" data-bind="text: prizeCard, attr: { 'aria-label': 'Prize card: ' + prizeCard() }"></button>
                <!-- /ko -->
                <!-- ko if: prizeCard() === null -->
                <span class="prize-placeholder">Prize card will appear here</span>
                <!-- /ko -->
            </div>
            <!-- ko foreach: gamePlayers -->
            <div class="game-section player-section">
                <h2>
                    <span data-bind="text: name"></span>
                    <span class="points" data-bind="text: '— ' + points() + ' pts'"></span>
                </h2>
                <div class="card-row">
                    <!-- ko foreach: hand -->
                    <button class="card-btn" data-bind="text: $root.revealed() ? $data : '', css: { 'hidden-card': !$root.revealed() }"></button>
                    <!-- /ko -->
                </div>
            </div>
            <!-- /ko -->
            <!-- ko with: humanPlayer -->
            <div class="game-section human-section">
                <h2>
                    Your Hand
                    <span class="points" data-bind="text: '— ' + points() + ' pts'"></span>
                </h2>
                <div class="card-row">
                    <!-- ko foreach: hand -->
                    <button class="card-btn clickable" data-bind="text: $data, click: $root.humanBid.bind($root, $data), attr: { 'aria-label': 'Bid card ' + $data }"></button>
                    <!-- /ko -->
                </div>
            </div>
            <!-- /ko -->
            <!-- ko if: roundResult() -->
            <div class="round-result" aria-live="assertive" data-bind="text: roundResult"></div>
            <!-- /ko -->
            <!-- ko if: gameOver() -->
            <div class="game-over" aria-live="assertive">
                <h2>Game Over</h2>
                <!-- ko with: finalStandings()[0] -->
                <div class="winner-announcement" data-bind="text: name + ' wins with ' + points + ' pts and ' + roundsWon + ' rounds won!'"></div>
                <!-- /ko -->
                <h3>Final Standings</h3>
                <!-- ko foreach: finalStandings -->
                <div class="standing-row" data-bind="css: { 'winner-row': $index() === 0 }">
                    <span data-bind="text: ($index() + 1) + '. ' + name"></span>
                    <span data-bind="text: ' — ' + points + ' pts, ' + roundsWon + ' rounds won'"></span>
                </div>
                <!-- /ko -->
            </div>
            <!-- /ko -->
            <!-- ko ifnot: gameOver() -->
            <!-- ko ifnot: roundActive() -->
            <button class="go-btn" aria-label="Reveal next prize card" data-bind="click: $root.go">Go</button>
            <!-- /ko -->
            <!-- ko if: roundActive() -->
            <span class="bid-prompt" aria-live="polite">Select a card from your hand to bid</span>
            <!-- /ko -->
            <!-- /ko -->
        </div>
        <!-- /ko -->

        <!-- ko if: currentView() === "config" -->
        <div class="config-form">
            <h1>Configuration</h1>
            <div class="form-group">
                <label for="numCardsPerHand">Cards per Hand</label>
                <input id="numCardsPerHand" type="number" min="1" data-bind="value: numCardsPerHand"
                       title="Number of cards dealt to each player and the kitty.">
            </div>
            <div class="form-group">
                <label for="numOpponents">Number of Opponents</label>
                <input id="numOpponents" type="number" min="1" data-bind="value: numOpponents"
                       title="Number of automated opponents.">
            </div>
            <div class="player-names">
                <h2>Opponents</h2>
                <!-- ko foreach: opponents -->
                <div class="opponent-config">
                    <div class="form-group">
                        <label data-bind="text: 'Opponent ' + ($index() + 1) + ' Name'"></label>
                        <input type="text" data-bind="value: name">
                    </div>
                    <div class="form-group">
                        <label data-bind="text: 'Opponent ' + ($index() + 1) + ' Strategy'"></label>
                        <select data-bind="options: $root.availableStrategies, value: strategy, optionsText: function(item) { return item.charAt(0).toUpperCase() + item.slice(1); }" title="AI strategy for this opponent."></select>
                    </div>
                </div>
                <!-- /ko -->
            </div>
            <div class="validation-error" role="alert" data-bind="visible: validationError(), text: validationError"></div>
            <button class="save-btn" aria-label="Save configuration" data-bind="click: saveConfig">Save</button>
        </div>
        <!-- /ko -->
    </main>
    <!-- Third-party libraries: jQuery 3.7.1 (MIT), Knockout JS 3.5.1 (MIT) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.min.js"
            integrity="sha512-vs7+jbztHoMto5Yd/yinM4/y2DOkPLt0fATcN+j+G4ANY2z4faIzZIOMkpBmWdcxt+596FemCh9M18NUJTZwvw=="
            crossorigin="anonymous"></script>
    <script src="js/game.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
